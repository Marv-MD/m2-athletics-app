<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>M2-Athletics</title>
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Custom pulse animation for active timer - Yellow/Amber */
      @keyframes pulse-ring {
        0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.7); }
        70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(250, 204, 21, 0); }
        100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(250, 204, 21, 0); }
      }
      .animate-pulse-ring {
        animation: pulse-ring 2s infinite;
      }
      /* Hide scrollbar for cleaner mobile look */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      /* Metal/Industrial Gradient Text */
      .metal-text {
        background: linear-gradient(to bottom, #fde047, #ca8a04);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      /* Fade in animation */
      @keyframes fade-in {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fade-in 0.3s ease-out forwards;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-black text-zinc-200 select-none overflow-hidden fixed inset-0 font-sans">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel" data-presets="typescript,react">
        const { useState, useEffect, useRef } = React;

        // --- CONSTANTS & ENUMS (Converted to JS Objects to fix ReferenceError) ---
        const ExerciseType = {
            REPS_WEIGHT: 'REPS_WEIGHT',
            DURATION_WEIGHT: 'DURATION_WEIGHT'
        };

        const SkillCategory = {
            PLANCHE: 'PLANCHE',
            FRONT_LEVER: 'FRONT_LEVER',
            BACK_LEVER: 'BACK_LEVER',
            MUSCLE_UP: 'MUSCLE_UP',
            HANDSTAND: 'HANDSTAND',
            HUMAN_FLAG: 'HUMAN_FLAG',
            DRAGON_SQUAT: 'DRAGON_SQUAT'
        };

        const AppTab = {
            HOME: 'HOME',
            WORKOUT: 'WORKOUT',
            SKILLS: 'SKILLS',
            PROGRESS: 'PROGRESS'
        };

        // --- DATA INITIALIZATION ---
        const createSkill = (id, name, req, cat, parent, unlocked = false) => ({
            id, name, description: `Master the ${name}`, requirements: req, category: cat, parentId: parent, unlocked
        });

        const INITIAL_SKILLS = [
            createSkill('pl1', 'Frog Stand', 'Hold 30s', SkillCategory.PLANCHE, undefined, true),
            createSkill('pl2', 'Tuck Planche', 'Frog Stand 30s', SkillCategory.PLANCHE, 'pl1'),
            createSkill('pl3', 'Adv. Tuck Planche', 'Tuck 15s', SkillCategory.PLANCHE, 'pl2'),
            createSkill('pl4', 'Straddle Planche', 'Adv Tuck 10s', SkillCategory.PLANCHE, 'pl3'),
            createSkill('pl5', 'Full Planche', 'Straddle 5s', SkillCategory.PLANCHE, 'pl4'),

            createSkill('fl1', 'Tuck Front Lever', 'Hold 20s', SkillCategory.FRONT_LEVER, undefined, true),
            createSkill('fl2', 'Adv. Tuck FL', 'Tuck 20s', SkillCategory.FRONT_LEVER, 'fl1'),
            createSkill('fl3', 'Straddle FL', 'Adv Tuck 10s', SkillCategory.FRONT_LEVER, 'fl2'),
            createSkill('fl4', 'Full Front Lever', 'Straddle 5s', SkillCategory.FRONT_LEVER, 'fl3'),

            createSkill('bl1', 'German Hang', 'Comfortable 30s', SkillCategory.BACK_LEVER, undefined, true),
            createSkill('bl2', 'Tuck Back Lever', 'German Hang', SkillCategory.BACK_LEVER, 'bl1'),
            createSkill('bl3', 'Full Back Lever', 'Tuck 15s', SkillCategory.BACK_LEVER, 'bl2'),

            createSkill('mu1', 'High Pull Up', '10 Reps', SkillCategory.MUSCLE_UP, undefined, true),
            createSkill('mu2', 'Negative MU', 'Control descent', SkillCategory.MUSCLE_UP, 'mu1'),
            createSkill('mu3', 'Kipping MU', 'Use hips', SkillCategory.MUSCLE_UP, 'mu2'),
            createSkill('mu4', 'Strict MU', 'No momentum', SkillCategory.MUSCLE_UP, 'mu3'),

            createSkill('hs1', 'Wall Hold', '60s Chest to wall', SkillCategory.HANDSTAND, undefined, true),
            createSkill('hs2', 'Kick Up', 'Find balance', SkillCategory.HANDSTAND, 'hs1'),
            createSkill('hs3', 'Freestanding HS', 'Hold 10s', SkillCategory.HANDSTAND, 'hs2'),
            createSkill('hs4', 'HS Pushup', '1 Rep', SkillCategory.HANDSTAND, 'hs3'),

            createSkill('hf1', 'Vertical Flag', 'Hold 20s', SkillCategory.HUMAN_FLAG, undefined, true),
            createSkill('hf2', 'Tuck Flag', 'Vertical 20s', SkillCategory.HUMAN_FLAG, 'hf1'),
            createSkill('hf3', 'Full Flag', 'Tuck 10s', SkillCategory.HUMAN_FLAG, 'hf2'),

            createSkill('ds1', 'Deep Squat', 'Ass to grass', SkillCategory.DRAGON_SQUAT, undefined, true),
            createSkill('ds2', 'Shrimp Squat', '5 Reps', SkillCategory.DRAGON_SQUAT, 'ds1'),
            createSkill('ds3', 'Pistol Squat', '5 Reps', SkillCategory.DRAGON_SQUAT, 'ds2'),
            createSkill('ds4', 'Dragon Squat', '1 Rep', SkillCategory.DRAGON_SQUAT, 'ds3'),
        ];

        const INITIAL_WORKOUT = {
            id: 'w1',
            name: 'Iron Push Day',
            exercises: [
                {
                    id: 'e1',
                    name: 'Tuck Planche Hold',
                    type: ExerciseType.DURATION_WEIGHT,
                    sets: [
                        { id: 's1-1', weight: 0, repsOrDuration: 10, completed: false },
                        { id: 's1-2', weight: 0, repsOrDuration: 10, completed: false },
                        { id: 's1-3', weight: 0, repsOrDuration: 10, completed: false },
                    ],
                },
                {
                    id: 'e2',
                    name: 'Weighted Dips',
                    type: ExerciseType.REPS_WEIGHT,
                    sets: [
                        { id: 's2-1', weight: 10, repsOrDuration: 8, completed: false },
                        { id: 's2-2', weight: 10, repsOrDuration: 8, completed: false },
                        { id: 's2-3', weight: 10, repsOrDuration: 8, completed: false },
                    ],
                },
            ],
        };

        // --- STORAGE SERVICE ---
        const STORAGE_KEYS = {
            LOGS: 'm2_tracker_logs',
            SKILLS: 'm2_tracker_skills',
            CURRENT_TEMPLATE: 'm2_tracker_template',
            EXERCISE_LIBRARY: 'm2_tracker_library',
            CURRENT_GOAL: 'm2_tracker_goal',
            PROFILE_IMAGE: 'm2_tracker_profile_image'
        };

        const loadLogs = () => {
            const data = localStorage.getItem(STORAGE_KEYS.LOGS);
            return data ? JSON.parse(data) : [];
        };
        const saveLogs = (logs) => localStorage.setItem(STORAGE_KEYS.LOGS, JSON.stringify(logs));

        const loadSkills = () => {
            const data = localStorage.getItem(STORAGE_KEYS.SKILLS);
            return data ? JSON.parse(data) : INITIAL_SKILLS;
        };
        const saveSkills = (skills) => localStorage.setItem(STORAGE_KEYS.SKILLS, JSON.stringify(skills));

        const loadTemplate = () => {
            const data = localStorage.getItem(STORAGE_KEYS.CURRENT_TEMPLATE);
            return data ? JSON.parse(data) : INITIAL_WORKOUT;
        };
        const saveTemplate = (template) => localStorage.setItem(STORAGE_KEYS.CURRENT_TEMPLATE, JSON.stringify(template));

        const getExerciseLibrary = () => {
            const data = localStorage.getItem(STORAGE_KEYS.EXERCISE_LIBRARY);
            if (data) return JSON.parse(data);
            return ['Bench Press', 'Pull Up', 'Dip', 'Squat', 'Deadlift', 'Overhead Press', 'Planche Lean', 'Front Lever Hold', 'Handstand Hold'];
        };
        const addToLibrary = (exerciseNames) => {
            const current = getExerciseLibrary();
            const newSet = new Set([...current, ...exerciseNames]);
            localStorage.setItem(STORAGE_KEYS.EXERCISE_LIBRARY, JSON.stringify(Array.from(newSet).sort()));
        };

        const loadGoal = () => localStorage.getItem(STORAGE_KEYS.CURRENT_GOAL) || "Achieve Full Planche";
        const saveGoal = (goal) => localStorage.setItem(STORAGE_KEYS.CURRENT_GOAL, goal);

        const loadProfileImage = () => localStorage.getItem(STORAGE_KEYS.PROFILE_IMAGE);
        const saveProfileImage = (img) => localStorage.setItem(STORAGE_KEYS.PROFILE_IMAGE, img);

        // --- COMPONENTS ---
        
        // Stopwatch
        const Stopwatch = ({ onStop, initialValue = 0 }) => {
            const [isRunning, setIsRunning] = useState(false);
            const [time, setTime] = useState(0);
            const intervalRef = useRef(null);

            useEffect(() => {
                return () => { if (intervalRef.current) window.clearInterval(intervalRef.current); };
            }, []);

            const toggleTimer = () => {
                if (isRunning) {
                    if (intervalRef.current) window.clearInterval(intervalRef.current);
                    setIsRunning(false);
                    onStop(time);
                    setTime(0);
                } else {
                    setTime(0);
                    setIsRunning(true);
                    intervalRef.current = window.setInterval(() => setTime(p => p + 1), 1000);
                }
            };

            return (
                <button onClick={toggleTimer} className={`relative flex items-center justify-center w-12 h-12 rounded-lg transition-all active:scale-95 border ${isRunning ? 'bg-yellow-500 border-yellow-400 text-black animate-pulse-ring' : 'bg-zinc-800 border-zinc-700 text-zinc-400 hover:bg-zinc-700'}`}>
                    <i className={`fas ${isRunning ? 'fa-stop' : 'fa-stopwatch'} text-lg`}></i>
                    {isRunning && <span className="absolute -top-3 left-1/2 transform -translate-x-1/2 text-[10px] font-bold text-yellow-500 bg-black border border-yellow-500/30 px-1 rounded">{time}s</span>}
                </button>
            );
        };

        // ExerciseCard
        const ExerciseCard = ({ exercise, isSupersetTop, isSupersetBottom, onUpdateSet, onAddSet, onDeleteSet, onDeleteExercise, onLinkSuperset, onUpdateName, onToggleType }) => {
            const isTimeBased = exercise.type === ExerciseType.DURATION_WEIGHT;
            const [isEditingTitle, setIsEditingTitle] = useState(false);

            return (
                <div className={`relative flex ${isSupersetTop ? 'mb-0 pb-4' : 'mb-4'} ${isSupersetBottom ? 'pt-0' : ''}`}>
                    {(isSupersetTop || isSupersetBottom) && <div className="absolute left-[-12px] top-4 bottom-[-16px] w-1 bg-yellow-500 rounded-full z-0 opacity-80"></div>}
                    <div className={`flex-1 bg-zinc-900 rounded-xl p-4 shadow-lg border border-zinc-800 relative z-10 ${(isSupersetTop || isSupersetBottom) ? 'border-l-4 border-l-yellow-500/50' : ''}`}>
                        <div className="flex justify-between items-start mb-4">
                            <div className="flex-1 mr-2">
                                {isEditingTitle ? (
                                    <input className="bg-black text-yellow-400 font-bold text-lg w-full px-2 py-1 rounded border border-zinc-700 focus:outline-none focus:border-yellow-500" value={exercise.name} onChange={(e) => onUpdateName(exercise.id, e.target.value)} onBlur={() => setIsEditingTitle(false)} autoFocus />
                                ) : (
                                    <h3 onClick={() => setIsEditingTitle(true)} className="text-lg font-bold text-zinc-100 hover:text-yellow-400 cursor-text transition-colors">{exercise.name} <i className="fas fa-pen text-xs text-zinc-600 ml-2"></i></h3>
                                )}
                                <div className="flex gap-2 mt-1">
                                    <button onClick={() => onToggleType(exercise.id)} className="text-[10px] bg-zinc-800 px-2 py-0.5 rounded text-zinc-400 border border-zinc-700 hover:text-yellow-500 hover:border-yellow-500 transition-colors">
                                        {isTimeBased ? <><i className="fas fa-clock mr-1"></i> TIME</> : <><i className="fas fa-redo mr-1"></i> REPS</>}
                                    </button>
                                    {exercise.supersetId && <span className="text-[10px] bg-yellow-900/30 px-2 py-0.5 rounded text-yellow-500 border border-yellow-500/30">SUPERSET</span>}
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => onLinkSuperset(exercise.id)} className={`h-8 w-8 rounded flex items-center justify-center transition-colors ${exercise.supersetId ? 'bg-yellow-500 text-black' : 'bg-zinc-800 text-zinc-500 hover:text-zinc-300'}`}><i className="fas fa-link text-xs"></i></button>
                                <button onClick={() => onDeleteExercise(exercise.id)} className="h-8 w-8 rounded bg-zinc-800 text-red-900 hover:text-red-500 flex items-center justify-center transition-colors"><i className="fas fa-trash text-xs"></i></button>
                            </div>
                        </div>
                        <div className="grid grid-cols-12 gap-2 text-[10px] uppercase font-bold text-zinc-500 mb-2 px-1 text-center tracking-wider">
                            <div className="col-span-1">#</div><div className="col-span-3">kg</div><div className={`${isTimeBased ? 'col-span-4' : 'col-span-5'}`}>{isTimeBased ? 'Secs' : 'Reps'}</div>{isTimeBased && <div className="col-span-2">Timer</div>}<div className="col-span-2">Check</div><div className="col-span-1"></div>
                        </div>
                        <div className="space-y-2">
                            {exercise.sets.map((set, index) => (
                                <div key={set.id} className={`grid grid-cols-12 gap-2 items-center p-1 rounded-lg transition-all duration-300 ${set.completed ? 'bg-emerald-900/30 border border-emerald-900/50 shadow-inner' : 'bg-transparent border border-transparent'}`}>
                                    <div className={`col-span-1 text-center font-mono text-sm ${set.completed ? 'text-emerald-500 font-bold' : 'text-zinc-500'}`}>{index + 1}</div>
                                    <div className="col-span-3"><input type="number" value={set.weight} onChange={(e) => onUpdateSet(exercise.id, set.id, 'weight', parseFloat(e.target.value) || 0)} className={`w-full bg-black border rounded p-2 text-center text-sm focus:outline-none ${set.completed ? 'border-emerald-700 text-emerald-400' : 'border-zinc-700 text-zinc-200 focus:border-yellow-500'}`} placeholder="0" /></div>
                                    <div className={`${isTimeBased ? 'col-span-4' : 'col-span-5'}`}><input type="number" value={set.repsOrDuration} onChange={(e) => onUpdateSet(exercise.id, set.id, 'repsOrDuration', parseFloat(e.target.value) || 0)} className={`w-full bg-black border rounded p-2 text-center text-sm focus:outline-none ${set.completed ? 'border-emerald-700 text-emerald-400' : 'border-zinc-700 text-zinc-200 focus:border-yellow-500'}`} placeholder={isTimeBased ? 's' : 'reps'} /></div>
                                    {isTimeBased && <div className="col-span-2 flex justify-center"><Stopwatch onStop={(time) => onUpdateSet(exercise.id, set.id, 'repsOrDuration', time)} /></div>}
                                    <div className="col-span-2 flex justify-center"><button onClick={() => onUpdateSet(exercise.id, set.id, 'completed', !set.completed)} className={`w-10 h-10 rounded flex items-center justify-center transition-all ${set.completed ? 'bg-emerald-500 text-black shadow-[0_0_10px_rgba(16,185,129,0.4)] scale-105' : 'bg-zinc-800 text-zinc-600 hover:bg-zinc-700'}`}><i className="fas fa-check"></i></button></div>
                                    <div className="col-span-1 flex justify-center"><button onClick={() => onDeleteSet(exercise.id, set.id)} className="text-zinc-700 hover:text-red-500"><i className="fas fa-times"></i></button></div>
                                </div>
                            ))}
                        </div>
                        <button onClick={() => onAddSet(exercise.id)} className="w-full mt-4 py-2 bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700/50 rounded-lg text-xs font-bold text-zinc-400 uppercase tracking-widest transition-colors">+ Add Set</button>
                    </div>
                </div>
            );
        };

        // HomeView
        const HomeView = ({ onStartWorkout }) => {
            const [logs, setLogs] = useState([]);
            const [showSelector, setShowSelector] = useState(false);
            const [selectedHistoryLog, setSelectedHistoryLog] = useState(null);
            const [currentGoal, setCurrentGoal] = useState("");
            const [profileImage, setProfileImage] = useState(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                setLogs(loadLogs());
                setCurrentGoal(loadGoal());
                setProfileImage(loadProfileImage());
            }, []);

            const handleImageUpload = (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setProfileImage(reader.result);
                        saveProfileImage(reader.result);
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            };

            const formatDuration = (s) => `${Math.floor(s / 60)}m`;

            return (
                <div className="pb-24 pt-8 px-4 h-full overflow-y-auto no-scrollbar flex flex-col bg-black text-zinc-200">
                    <div className="flex items-center justify-between mb-8">
                        <div><h1 className="text-4xl font-black italic tracking-tighter"><span className="metal-text">M</span><sup className="text-2xl text-yellow-400" style={{ WebkitTextFillColor: '#facc15' }}>2</sup><span className="metal-text">-ATHLETICS</span></h1></div>
                        <div onClick={() => fileInputRef.current?.click()} className="h-12 w-12 bg-zinc-900 rounded-full flex items-center justify-center border border-zinc-800 shadow-inner overflow-hidden cursor-pointer relative group">
                            {profileImage ? <img src={profileImage} alt="Profile" className="h-full w-full object-cover" /> : <i className="fas fa-user text-zinc-600 group-hover:text-yellow-500 transition-colors"></i>}
                            <input type="file" ref={fileInputRef} onChange={handleImageUpload} accept="image/*" className="hidden" />
                        </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-8">
                        <div className="bg-zinc-900 p-4 rounded-xl border border-zinc-800 shadow-lg">
                            <div className="text-zinc-500 text-[10px] uppercase font-bold mb-1 tracking-widest">Sessions</div>
                            <div className="text-3xl font-mono font-bold text-white">{logs.length}</div>
                        </div>
                        <div className="bg-zinc-900 p-4 rounded-xl border border-zinc-800 shadow-lg flex flex-col">
                            <div className="text-zinc-500 text-[10px] uppercase font-bold mb-1 tracking-widest text-yellow-500">Current Goal</div>
                            <textarea value={currentGoal} onChange={(e) => {setCurrentGoal(e.target.value); saveGoal(e.target.value)}} placeholder="Enter goal..." className="bg-transparent text-sm text-zinc-200 w-full h-full resize-none focus:outline-none placeholder-zinc-700" />
                        </div>
                    </div>
                    <button onClick={() => setShowSelector(true)} className="w-full bg-yellow-500 hover:bg-yellow-400 py-5 rounded-xl font-black text-black text-xl shadow-[0_0_20px_rgba(234,179,8,0.2)] mb-10 active:scale-[0.98] transition-transform flex items-center justify-center gap-3 uppercase tracking-wider skew-x-[-2deg]">
                        <i className="fas fa-play text-sm"></i> Start Session
                    </button>
                    <h2 className="text-sm font-bold text-zinc-500 uppercase tracking-widest mb-4 border-b border-zinc-800 pb-2">Log History</h2>
                    {logs.length === 0 ? <div className="text-center py-12 bg-zinc-900/50 rounded-xl border border-zinc-800 border-dashed"><p className="text-zinc-600 font-mono">No data found.</p></div> : 
                        <div className="space-y-3">{logs.slice(0, 10).map((log) => (
                            <div key={log.id} onClick={() => setSelectedHistoryLog(log)} className="bg-zinc-900 p-4 rounded-lg border-l-4 border-l-zinc-700 hover:border-l-yellow-500 hover:bg-zinc-800 transition-all cursor-pointer flex justify-between items-center group">
                                <div><h3 className="font-bold text-zinc-200 group-hover:text-white">{log.templateName}</h3><p className="text-xs text-zinc-500 font-mono mt-1">{new Date(log.date).toLocaleDateString()} â€¢ <span className="text-zinc-600">{formatDuration(log.durationSeconds)}</span></p></div>
                                <div className="text-right"><span className="block text-yellow-600 font-bold text-sm">{log.exercises.length} Exercises</span></div>
                            </div>
                        ))}</div>
                    }
                    {showSelector && <div className="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                        <div className="bg-zinc-900 w-full max-w-sm rounded-2xl border border-zinc-700 shadow-2xl overflow-hidden">
                            <div className="p-4 border-b border-zinc-800 flex justify-between items-center"><h3 className="text-lg font-bold text-white">Select Template</h3><button onClick={() => setShowSelector(false)}><i className="fas fa-times text-zinc-500"></i></button></div>
                            <div className="max-h-[60vh] overflow-y-auto p-2 space-y-2">
                                <button onClick={() => {onStartWorkout(); setShowSelector(false)}} className="w-full text-left p-4 bg-zinc-800 hover:bg-zinc-700 rounded-lg border border-zinc-700 group"><div className="font-bold text-yellow-500">Resume Last Session</div></button>
                                <button onClick={() => {onStartWorkout(INITIAL_WORKOUT); setShowSelector(false)}} className="w-full text-left p-4 bg-zinc-800 hover:bg-zinc-700 rounded-lg border border-zinc-700"><div className="font-bold text-white">Default Push Day</div></button>
                                <div className="text-xs font-bold text-zinc-600 uppercase mt-4 px-2">Copy from History</div>
                                {logs.slice(0, 5).map(log => <button key={log.id} onClick={() => {
                                    onStartWorkout({ id: Date.now().toString(), name: log.templateName, exercises: log.exercises, startTime: undefined }); setShowSelector(false);
                                }} className="w-full text-left p-3 bg-black hover:bg-zinc-800 rounded border border-zinc-800 flex justify-between"><span className="text-zinc-300 text-sm font-bold">{log.templateName}</span><span className="text-zinc-600 text-xs">{new Date(log.date).toLocaleDateString()}</span></button>)}
                            </div>
                        </div>
                    </div>}
                    {selectedHistoryLog && <div className="fixed inset-0 bg-black/95 z-50 flex flex-col p-6 animate-fade-in">
                        <div className="flex justify-between items-start mb-6 border-b border-zinc-800 pb-4">
                            <div><h2 className="text-2xl font-bold text-white">{selectedHistoryLog.templateName}</h2><p className="text-yellow-500 text-sm font-mono">{new Date(selectedHistoryLog.date).toLocaleString()} <span className="ml-3 text-zinc-500"><i className="fas fa-clock mr-1"></i>{formatDuration(selectedHistoryLog.durationSeconds)}</span></p></div>
                            <button onClick={() => setSelectedHistoryLog(null)} className="h-8 w-8 bg-zinc-800 rounded-full flex items-center justify-center"><i className="fas fa-times text-zinc-400"></i></button>
                        </div>
                        <div className="flex-1 overflow-y-auto space-y-4 no-scrollbar">
                            {selectedHistoryLog.exercises.map((ex, i) => <div key={i} className="bg-zinc-900 p-4 rounded-xl border border-zinc-800"><h4 className="font-bold text-zinc-300 mb-2">{ex.name}</h4><div className="space-y-1">{ex.sets.map((s, j) => <div key={j} className={`flex justify-between text-xs font-mono border-b border-zinc-800/50 pb-1 last:border-0 ${s.completed ? 'text-zinc-400' : 'text-zinc-700'}`}><span>Set {j+1}</span><span>{s.weight}kg x {s.repsOrDuration}{ex.type === ExerciseType.DURATION_WEIGHT ? 's' : ''}{s.completed && <i className="fas fa-check ml-2 text-yellow-600"></i>}</span></div>)}</div></div>)}
                        </div>
                        <button onClick={() => { onStartWorkout({ id: Date.now().toString(), name: selectedHistoryLog.templateName, exercises: selectedHistoryLog.exercises, startTime: undefined }); setSelectedHistoryLog(null); }} className="mt-4 w-full bg-zinc-800 border border-yellow-600/30 text-yellow-500 py-3 rounded-lg font-bold uppercase tracking-wider text-sm hover:bg-zinc-700">Copy This Workout</button>
                    </div>}
                </div>
            );
        };

        // WorkoutView
        const WorkoutView = ({ onFinish, initialTemplate }) => {
            const [workout, setWorkout] = useState(null);
            const [isEditingName, setIsEditingName] = useState(false);
            const [elapsedTime, setElapsedTime] = useState(0);
            const [showAddModal, setShowAddModal] = useState(false);
            const [showSummaryModal, setShowSummaryModal] = useState(false);
            const [library, setLibrary] = useState([]);
            const [summaryStats, setSummaryStats] = useState([]);
            const [isStarted, setIsStarted] = useState(false);

            useEffect(() => {
                setLibrary(getExerciseLibrary());
                let loadedWorkout;
                if (initialTemplate) {
                    loadedWorkout = JSON.parse(JSON.stringify(initialTemplate));
                    loadedWorkout.id = 'current_active';
                    loadedWorkout.exercises.forEach(ex => ex.sets.forEach(s => s.completed = false));
                    loadedWorkout.startTime = undefined;
                    saveTemplate(loadedWorkout);
                    setWorkout(loadedWorkout);
                    setIsStarted(false);
                } else {
                    loadedWorkout = loadTemplate();
                    setIsStarted(!!loadedWorkout.startTime);
                    setWorkout(JSON.parse(JSON.stringify(loadedWorkout)));
                }
            }, [initialTemplate]);

            useEffect(() => {
                if (!workout || !isStarted || !workout.startTime) {
                    if (!isStarted) setElapsedTime(0);
                    return;
                }
                const initialDiff = Math.floor((Date.now() - workout.startTime) / 1000);
                setElapsedTime(initialDiff);
                const interval = setInterval(() => {
                    const diff = Math.floor((Date.now() - workout.startTime) / 1000);
                    setElapsedTime(diff);
                }, 1000);
                return () => clearInterval(interval);
            }, [isStarted, workout?.startTime]);

            const formatTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, '0')}`;
            const saveWorkoutState = (w) => { setWorkout(w); saveTemplate(w); };

            const handleStartWorkout = () => {
                if (!workout) return;
                const now = Date.now();
                const u = { ...workout, startTime: now };
                setWorkout(u); saveTemplate(u); setIsStarted(true);
            };

            const finishWorkout = () => {
                if (!workout) return;
                const allLogs = loadLogs();
                const stats = [];
                workout.exercises.forEach(currEx => {
                    const prevLog = allLogs.find(log => log.exercises.some(e => e.name === currEx.name));
                    if (prevLog) {
                        const prevEx = prevLog.exercises.find(e => e.name === currEx.name);
                        const currMax = Math.max(...currEx.sets.filter(s=>s.completed).map(s => Number(s.weight)), 0);
                        const prevMax = Math.max(...prevEx.sets.filter(s=>s.completed).map(s => Number(s.weight)), 0);
                        const currVol = currEx.sets.filter(s=>s.completed).reduce((a, b) => a + Number(b.repsOrDuration), 0);
                        const prevVol = prevEx.sets.filter(s=>s.completed).reduce((a, b) => a + Number(b.repsOrDuration), 0);
                        let diffString = "";
                        if (currMax > prevMax) diffString = `Max Weight: +${(currMax - prevMax).toFixed(1)}kg ðŸš€`;
                        else if (currMax < prevMax) diffString = `Max Weight: ${currMax - prevMax}kg`;
                        else if (currVol > prevVol) diffString = `Volume: +${currVol - prevVol} reps/s ðŸ”¥`;
                        else diffString = "Maintained performance";
                        stats.push({ name: currEx.name, diff: diffString });
                    } else {
                        stats.push({ name: currEx.name, diff: "New Exercise Logged! ðŸŽ‰" });
                    }
                });
                setSummaryStats(stats);
                
                const newLog = {
                    id: Date.now().toString(),
                    date: new Date().toISOString(),
                    durationSeconds: elapsedTime,
                    templateName: workout.name,
                    exercises: workout.exercises,
                    totalVolume: 0
                };
                saveLogs([newLog, ...allLogs]);
                addToLibrary(workout.exercises.map(e => e.name));
                const resetExercises = workout.exercises.map(ex => ({...ex, sets: ex.sets.map(s => ({...s, completed: false}))}));
                saveTemplate({...workout, startTime: undefined, exercises: resetExercises});
                setShowSummaryModal(true);
            };

            const handleUpdateSet = (eid, sid, f, v) => {
                const exs = workout.exercises.map(e => e.id === eid ? { ...e, sets: e.sets.map(s => s.id === sid ? { ...s, [f]: v } : s) } : e);
                saveWorkoutState({ ...workout, exercises: exs });
            };
            const handleAddSet = (eid) => {
                const exs = workout.exercises.map(e => {
                    if (e.id === eid) {
                        const last = e.sets[e.sets.length - 1];
                        return { ...e, sets: [...e.sets, { id: Date.now().toString(), weight: last ? last.weight : 0, repsOrDuration: last ? last.repsOrDuration : 0, completed: false }] };
                    }
                    return e;
                });
                saveWorkoutState({ ...workout, exercises: exs });
            };
            const handleDeleteSet = (eid, sid) => saveWorkoutState({ ...workout, exercises: workout.exercises.map(e => e.id === eid ? { ...e, sets: e.sets.filter(s => s.id !== sid) } : e) });
            const handleDeleteExercise = (eid) => saveWorkoutState({ ...workout, exercises: workout.exercises.filter(e => e.id !== eid) });
            const handleUpdateExerciseName = (eid, name) => saveWorkoutState({ ...workout, exercises: workout.exercises.map(e => e.id === eid ? { ...e, name } : e) });
            const handleToggleType = (eid) => saveWorkoutState({ ...workout, exercises: workout.exercises.map(e => e.id === eid ? { ...e, type: e.type === ExerciseType.REPS_WEIGHT ? ExerciseType.DURATION_WEIGHT : ExerciseType.REPS_WEIGHT } : e) });
            const handleLinkSuperset = (eid) => {
                 const idx = workout.exercises.findIndex(e => e.id === eid);
                 if (idx === -1 || idx === workout.exercises.length - 1) return;
                 const c = workout.exercises[idx], n = workout.exercises[idx + 1];
                 let sid = c.supersetId;
                 const exs = [...workout.exercises];
                 if (c.supersetId && n.supersetId === c.supersetId) { exs[idx] = { ...c, supersetId: undefined }; }
                 else { if (!sid) sid = Date.now().toString(); exs[idx] = { ...c, supersetId: sid }; exs[idx+1] = { ...n, supersetId: sid }; }
                 saveWorkoutState({ ...workout, exercises: exs });
            };
            const handleAddEx = (name) => {
                const ne = { id: Date.now().toString(), name, type: ExerciseType.REPS_WEIGHT, sets: [{ id: Date.now() + '-1', weight: 0, repsOrDuration: 10, completed: false }] };
                saveWorkoutState({ ...workout, exercises: [...workout.exercises, ne] }); setShowAddModal(false);
            };

            if (!workout) return <div className="p-4 text-center text-zinc-500">Initializing...</div>;

            return (
                <div className={`pb-24 pt-4 px-4 h-full overflow-y-auto no-scrollbar bg-black ${!isStarted ? 'opacity-90' : ''}`}>
                    <div className="flex justify-between items-center mb-6 sticky top-0 bg-black/90 backdrop-blur-sm py-3 z-20 border-b border-zinc-800">
                        <div className="flex-1 mr-4">
                            {isEditingName ? <input value={workout.name} onChange={(e) => saveWorkoutState({ ...workout, name: e.target.value })} onBlur={() => setIsEditingName(false)} autoFocus className="bg-black text-2xl font-bold text-yellow-400 border border-zinc-700 w-full px-2 py-1 rounded focus:outline-none" /> : 
                            <div onClick={() => setIsEditingName(true)} className="group cursor-pointer"><h1 className="text-xl font-bold text-zinc-100 group-hover:text-yellow-400 transition-colors truncate max-w-[200px]">{workout.name} <i className="fas fa-pen text-[10px] text-zinc-700 group-hover:text-yellow-600 align-top"></i></h1><div className="flex items-center gap-2 text-yellow-500 font-mono text-sm"><i className={`fas fa-stopwatch ${isStarted ? 'animate-pulse' : ''}`}></i><span>{formatTime(elapsedTime)}</span></div></div>}
                        </div>
                        {!isStarted ? <button onClick={handleStartWorkout} className="bg-emerald-500 hover:bg-emerald-400 text-black font-bold py-2 px-6 rounded shadow-[0_0_15px_rgba(16,185,129,0.3)] active:scale-95 transition-all text-sm uppercase tracking-wider">Start</button> : <button onClick={finishWorkout} className="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-2 px-3 rounded shadow-[0_0_15px_rgba(234,179,8,0.3)] active:scale-95 transition-all text-xs uppercase tracking-wider">Finish</button>}
                    </div>
                    <div className={`space-y-1 transition-opacity duration-500 ${!isStarted ? 'opacity-50 pointer-events-none grayscale-[50%]' : ''}`}>
                        {workout.exercises.map((e, i) => {
                            const n = workout.exercises[i + 1], p = workout.exercises[i - 1];
                            const isTop = !!(e.supersetId && n && n.supersetId === e.supersetId);
                            const isBot = !!(e.supersetId && p && p.supersetId === e.supersetId);
                            return <ExerciseCard key={e.id} exercise={e} isSupersetTop={isTop} isSupersetBottom={isBot} onUpdateSet={handleUpdateSet} onAddSet={handleAddSet} onDeleteSet={handleDeleteSet} onDeleteExercise={handleDeleteExercise} onLinkSuperset={handleLinkSuperset} onUpdateName={handleUpdateExerciseName} onToggleType={handleToggleType} />;
                        })}
                        <button onClick={() => setShowAddModal(true)} className="w-full py-4 mt-6 border-2 border-dashed border-zinc-800 text-zinc-600 rounded-xl hover:border-yellow-500/50 hover:text-yellow-500 transition-all font-bold uppercase tracking-widest text-sm">+ Add Exercise</button>
                    </div>
                    {!isStarted && <div className="fixed inset-0 top-32 z-10 flex items-center justify-center pointer-events-none"><div className="bg-black/80 px-6 py-4 rounded-xl border border-zinc-800 backdrop-blur-md"><p className="text-zinc-400 font-bold uppercase tracking-widest">Tap Start to Begin</p></div></div>}
                    {showAddModal && <div className="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4"><div className="bg-zinc-900 w-full max-w-sm rounded-2xl border border-zinc-700 shadow-2xl overflow-hidden flex flex-col max-h-[70vh]"><div className="p-4 border-b border-zinc-800 flex justify-between items-center"><h3 className="text-lg font-bold text-white">Add Exercise</h3><button onClick={() => setShowAddModal(false)}><i className="fas fa-times text-zinc-500"></i></button></div><div className="p-2 border-b border-zinc-800"><button onClick={() => handleAddEx("New Exercise")} className="w-full py-3 bg-yellow-600/20 text-yellow-500 border border-yellow-600/50 rounded-lg font-bold">+ Create Custom</button></div><div className="flex-1 overflow-y-auto p-2 space-y-2"><p className="text-xs text-zinc-600 uppercase font-bold px-2 mb-2">From Library</p>{library.map((name, i) => <button key={i} onClick={() => handleAddEx(name)} className="w-full text-left p-3 bg-black hover:bg-zinc-800 rounded border border-zinc-800 text-zinc-300">{name}</button>)}</div></div></div>}
                    {showSummaryModal && <div className="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-6 animate-fade-in"><div className="w-full max-w-sm"><div className="text-center mb-8"><div className="inline-block p-4 rounded-full bg-yellow-500 mb-4 shadow-[0_0_30px_rgba(234,179,8,0.5)]"><i className="fas fa-trophy text-4xl text-black"></i></div><h2 className="text-3xl font-black italic text-white mb-1">WORKOUT COMPLETE</h2><p className="text-zinc-500 font-mono">{formatTime(elapsedTime)} duration</p></div><div className="bg-zinc-900 rounded-xl border border-zinc-800 p-4 mb-6 max-h-[40vh] overflow-y-auto"><h3 className="text-yellow-500 text-xs font-bold uppercase tracking-widest mb-4 border-b border-zinc-800 pb-2">Session Progress</h3><div className="space-y-3">{summaryStats.map((stat, i) => <div key={i} className="flex justify-between items-center text-sm"><span className="font-bold text-zinc-300">{stat.name}</span><span className="text-zinc-500 text-xs">{stat.diff}</span></div>)}</div></div><button onClick={() => {setShowSummaryModal(false); onFinish();}} className="w-full bg-white text-black font-black py-4 rounded-xl uppercase tracking-widest hover:scale-105 transition-transform">Back to Home</button></div></div>}
                </div>
            );
        };

        // SkillTreeView
        const SkillTreeView = () => {
            const [skills, setSkills] = useState([]);
            const [activeCategory, setActiveCategory] = useState(SkillCategory.PLANCHE);
            const [animatingSkillId, setAnimatingSkillId] = useState(null);

            useEffect(() => { setSkills(loadSkills()); }, []);

            const handleMasterSkill = (skillId) => {
                setAnimatingSkillId(skillId);
                setTimeout(() => {
                    const u = skills.map(s => s.parentId === skillId ? { ...s, unlocked: true } : s);
                    setSkills(u); saveSkills(u); setAnimatingSkillId(null);
                }, 1500);
            };

            const categories = Object.values(SkillCategory);
            const filteredSkills = skills.filter(s => s.category === activeCategory);
            const isMasterable = (skill) => {
                if (!skill.unlocked) return false;
                const children = skills.filter(s => s.parentId === skill.id);
                if (children.length === 0) return true;
                return children.some(child => !child.unlocked);
            };

            return (
                <div className="h-full bg-black flex flex-col overflow-hidden pb-24 pt-6">
                    <div className="flex-shrink-0 px-4 mb-4 z-10 bg-black"><h1 className="text-2xl font-bold text-white mb-2">Skill Progressions</h1><p className="text-zinc-500 text-sm">Select a discipline to view the path.</p></div>
                    <div className="flex-shrink-0 px-4 mb-2 z-10 bg-black border-b border-zinc-800 pb-4"><div className="flex overflow-x-auto gap-2 no-scrollbar">{categories.map(cat => <button key={cat} onClick={() => setActiveCategory(cat)} className={`whitespace-nowrap px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-colors border ${activeCategory === cat ? 'bg-yellow-500 text-black border-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.3)]' : 'bg-zinc-900 text-zinc-500 border-zinc-800 hover:border-zinc-700'}`}>{cat.replace('_', ' ')}</button>)}</div></div>
                    <div className="flex-1 px-4 relative overflow-y-auto no-scrollbar pt-4">
                        <div className="absolute left-8 top-4 bottom-4 w-0.5 bg-zinc-800"></div>
                        <div className="space-y-8 relative pb-8">
                            {filteredSkills.map(skill => {
                                const canMaster = isMasterable(skill);
                                const isAnimating = animatingSkillId === skill.id;
                                return (
                                    <div key={skill.id} className="relative pl-10">
                                        <div className={`absolute left-2.5 top-6 w-4 h-4 rounded-full border-2 transform -translate-x-1/2 transition-colors z-10 ${skill.unlocked ? 'bg-yellow-500 border-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.5)]' : 'bg-black border-zinc-700'}`}></div>
                                        <div className={`rounded-xl p-5 border transition-all relative overflow-hidden ${skill.unlocked ? 'bg-zinc-900 border-yellow-500/50' : 'bg-black border-zinc-800 opacity-60'}`}>
                                            {isAnimating && <div className="absolute inset-0 bg-emerald-500 z-20 flex items-center justify-center animate-pulse"><span className="text-black font-black text-xl uppercase tracking-widest transform scale-110">Unlocked!</span></div>}
                                            <div className="flex justify-between items-start mb-2"><h3 className={`font-bold text-lg ${skill.unlocked ? 'text-white' : 'text-zinc-500'}`}>{skill.name}</h3>{skill.unlocked && !canMaster && <i className="fas fa-check-circle text-emerald-500 text-lg"></i>}{!skill.unlocked && <i className="fas fa-lock text-zinc-700 text-sm"></i>}</div>
                                            <p className="text-zinc-400 text-sm mb-3 font-light">{skill.description}</p>
                                            <div className="bg-black/40 rounded p-2 text-[10px] font-mono text-zinc-300 border border-zinc-800 flex items-center mb-3"><i className="fas fa-clipboard-list text-yellow-600 mr-2"></i>{skill.requirements}</div>
                                            {canMaster && <button onClick={() => handleMasterSkill(skill.id)} className="w-full bg-zinc-800 hover:bg-zinc-700 text-zinc-200 text-xs font-bold uppercase py-2 rounded border border-zinc-700 hover:border-emerald-500/50 hover:text-emerald-500 transition-all flex items-center justify-center gap-2"><i className="fas fa-level-up-alt"></i> Complete & Unlock Next</button>}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // ProgressView
        const ProgressView = () => {
            const [logs, setLogs] = useState([]);
            const [exercises, setExercises] = useState([]);
            const [selectedExercise, setSelectedExercise] = useState('');
            const [metric, setMetric] = useState('WEIGHT');

            useEffect(() => {
                const loadedLogs = loadLogs();
                loadedLogs.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
                setLogs(loadedLogs);
                const allNames = new Set();
                loadedLogs.forEach(log => log.exercises.forEach(ex => allNames.add(ex.name)));
                const sortedNames = Array.from(allNames).sort();
                setExercises(sortedNames);
                if (sortedNames.length > 0) setSelectedExercise(sortedNames[0]);
            }, []);

            const chartData = logs.map(log => {
                const ex = log.exercises.find(e => e.name === selectedExercise);
                if (!ex) return null;
                let val = 0;
                if (metric === 'WEIGHT') val = Math.max(...ex.sets.filter(s => s.completed).map(s => Number(s.weight)), 0);
                else val = Math.max(...ex.sets.filter(s => s.completed).map(s => Number(s.repsOrDuration)), 0);
                if (val === 0) return null;
                return { date: new Date(log.date).toLocaleDateString(undefined, {month:'short', day:'numeric'}), value: val };
            }).filter(d => d !== null);

            const calculatePB = (en) => {
                let max = 0;
                logs.forEach(log => {
                    const ex = log.exercises.find(e => e.name === en);
                    if (ex) {
                        const vals = ex.sets.filter(s => s.completed).map(s => metric === 'WEIGHT' ? Number(s.weight) : Number(s.repsOrDuration));
                        const m = Math.max(...vals, 0);
                        if (m > max) max = m;
                    }
                });
                return max;
            };
            const currentPB = calculatePB(selectedExercise);

            const renderChart = () => {
                if (chartData.length < 2) return <div className="h-40 flex items-center justify-center text-zinc-600 text-sm">Not enough data to chart.</div>;
                const h = 200, w = 300, p = 20;
                const maxVal = Math.max(...chartData.map(d => d.value)) * 1.1;
                const getX = (i) => p + (i / (chartData.length - 1)) * (w - 2 * p);
                const getY = (v) => h - p - (v / maxVal) * (h - 2 * p);
                const points = chartData.map((d, i) => `${getX(i)},${getY(d.value)}`).join(' ');
                return (
                    <svg viewBox={`0 0 ${w} ${h}`} className="w-full h-full overflow-visible">
                        <line x1={p} y1={h-p} x2={w-p} y2={h-p} stroke="#52525b" strokeWidth="1" /><line x1={p} y1={p} x2={p} y2={h-p} stroke="#52525b" strokeWidth="1" />
                        <polyline points={points} fill="none" stroke={metric === 'WEIGHT' ? "#eab308" : "#10b981"} strokeWidth="3" />
                        {chartData.map((d, i) => <circle key={i} cx={getX(i)} cy={getY(d.value)} r="4" fill="#000" stroke={metric === 'WEIGHT' ? "#eab308" : "#10b981"} strokeWidth="2" />)}
                        {chartData.map((d, i) => <text key={i} x={getX(i)} y={h} fontSize="8" fill="#71717a" textAnchor="middle">{d.date}</text>)}
                    </svg>
                );
            };

            return (
                <div className="pb-24 pt-6 px-4 h-full overflow-y-auto no-scrollbar bg-black text-zinc-200">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-2xl font-bold text-white">Progress Tracker</h1>
                        <div className="flex bg-zinc-900 rounded-lg border border-zinc-700 p-1">
                            <button onClick={() => setMetric('WEIGHT')} className={`px-3 py-1 rounded text-xs font-bold transition-colors ${metric === 'WEIGHT' ? 'bg-yellow-500 text-black' : 'text-zinc-500'}`}>KG</button>
                            <button onClick={() => setMetric('TIME')} className={`px-3 py-1 rounded text-xs font-bold transition-colors ${metric === 'TIME' ? 'bg-emerald-500 text-black' : 'text-zinc-500'}`}>TIME</button>
                        </div>
                    </div>
                    <div className="mb-8"><label className="text-xs font-bold text-zinc-500 uppercase tracking-widest block mb-2">Select Exercise</label><select value={selectedExercise} onChange={(e) => setSelectedExercise(e.target.value)} className="w-full bg-zinc-900 border border-zinc-700 text-white p-3 rounded-lg focus:outline-none focus:border-yellow-500">{exercises.map(ex => <option key={ex} value={ex}>{ex}</option>)}</select></div>
                    {selectedExercise && <>
                        <div className={`bg-zinc-900 border border-zinc-800 p-6 rounded-2xl mb-8 flex justify-between items-center shadow-lg ${metric === 'WEIGHT' ? 'shadow-yellow-900/10' : 'shadow-emerald-900/10'}`}><div><div className="text-zinc-500 text-xs uppercase font-bold tracking-widest mb-1">Personal Best ({metric === 'WEIGHT' ? 'Weight' : 'Time'})</div><div className="text-4xl font-black text-white italic">{currentPB} <span className={`text-lg not-italic font-normal ml-1 ${metric === 'WEIGHT' ? 'text-yellow-500' : 'text-emerald-500'}`}>{metric === 'WEIGHT' ? 'kg' : 's/reps'}</span></div></div><div className="h-12 w-12 bg-black rounded-full flex items-center justify-center border border-zinc-800"><i className={`fas fa-crown ${metric === 'WEIGHT' ? 'text-yellow-500' : 'text-emerald-500'}`}></i></div></div>
                        <div className="bg-zinc-900 border border-zinc-800 p-4 rounded-2xl mb-8"><div className="text-zinc-500 text-xs uppercase font-bold tracking-widest mb-4">Max {metric === 'WEIGHT' ? 'Weight' : 'Time/Reps'} History</div><div className="h-48 w-full">{renderChart()}</div></div>
                        <h3 className="text-sm font-bold text-zinc-400 uppercase tracking-widest mb-4">Recent Logs</h3>
                        <div className="space-y-2">{logs.slice().reverse().filter(l => l.exercises.some(e => e.name === selectedExercise)).slice(0, 5).map(log => {
                            const ex = log.exercises.find(e => e.name === selectedExercise); if(!ex) return null;
                            const topSet = ex.sets.reduce((prev, current) => (Number(prev.weight) > Number(current.weight)) ? prev : current);
                            return <div key={log.id} className="bg-zinc-900 p-3 rounded border border-zinc-800 flex justify-between items-center"><span className="text-sm text-zinc-400">{new Date(log.date).toLocaleDateString()}</span><span className="font-mono font-bold text-white">{topSet.weight}kg x {topSet.repsOrDuration}</span></div>
                        })}</div>
                    </>}
                    {exercises.length === 0 && <div className="text-center py-10 text-zinc-500">No workout data available yet. Go lift something!</div>}
                </div>
            );
        };

        // App
        const App = () => {
            const [activeTab, setActiveTab] = useState(AppTab.HOME);
            const [pendingTemplate, setPendingTemplate] = useState(null);

            const handleStartWorkout = (template) => {
                setPendingTemplate(template || null);
                setActiveTab(AppTab.WORKOUT);
            };

            const renderContent = () => {
                switch (activeTab) {
                    case AppTab.HOME: return <HomeView onStartWorkout={handleStartWorkout} />;
                    case AppTab.WORKOUT: return <WorkoutView onFinish={() => setActiveTab(AppTab.HOME)} initialTemplate={pendingTemplate} />;
                    case AppTab.SKILLS: return <SkillTreeView />;
                    case AppTab.PROGRESS: return <ProgressView />;
                    default: return <HomeView onStartWorkout={handleStartWorkout} />;
                }
            };

            return (
                <div className="h-full flex flex-col bg-black max-w-md mx-auto relative shadow-2xl border-x border-zinc-800">
                    <main className="flex-1 overflow-hidden relative">{renderContent()}</main>
                    <nav className="absolute bottom-0 w-full bg-zinc-900 border-t border-zinc-800 h-20 pb-4 z-50">
                        <div className="grid grid-cols-4 h-full">
                            <button onClick={() => setActiveTab(AppTab.HOME)} className={`flex flex-col items-center justify-center space-y-1 transition-colors ${activeTab === AppTab.HOME ? 'text-yellow-500' : 'text-zinc-600'}`}><i className="fas fa-home text-lg"></i><span className="text-[9px] font-bold tracking-wide">HOME</span></button>
                            <button onClick={() => setActiveTab(AppTab.WORKOUT)} className={`flex flex-col items-center justify-center space-y-1 transition-colors ${activeTab === AppTab.WORKOUT ? 'text-yellow-500' : 'text-zinc-600'}`}><div className={`p-1.5 rounded-full transition-all ${activeTab === AppTab.WORKOUT ? 'bg-yellow-500/10 shadow-[0_0_10px_rgba(234,179,8,0.2)]' : ''}`}><i className="fas fa-dumbbell text-lg"></i></div><span className="text-[9px] font-bold tracking-wide">WORKOUT</span></button>
                            <button onClick={() => setActiveTab(AppTab.SKILLS)} className={`flex flex-col items-center justify-center space-y-1 transition-colors ${activeTab === AppTab.SKILLS ? 'text-yellow-500' : 'text-zinc-600'}`}><i className="fas fa-layer-group text-lg"></i><span className="text-[9px] font-bold tracking-wide">SKILLS</span></button>
                            <button onClick={() => setActiveTab(AppTab.PROGRESS)} className={`flex flex-col items-center justify-center space-y-1 transition-colors ${activeTab === AppTab.PROGRESS ? 'text-yellow-500' : 'text-zinc-600'}`}><i className="fas fa-chart-line text-lg"></i><span className="text-[9px] font-bold tracking-wide">PROGRESS</span></button>
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>